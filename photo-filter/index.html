<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="assets/favicon.ico" rel="shortcut icon" />
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;800&display=swap" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <title>photo-filter</title>
</head>

<body>
    <header class="header">
        <h1 class="header-title">Photo-filter</h1> </header>
    <main class="main">
        <div class="filters">
            <label> Blur:
                <input name="blur" data-sizing="px" type="range" min="0" max="10" value="0" />
                <output name="result" class=result>0</output>
            </label>
            <label> Invert:
                <input name="invert" data-sizing="%" type="range" min="0" max="100" value="0" />
                <output name="result" class=result>0</output>
            </label>
            <label> Sepia:
                <input name="sepia" data-sizing="%" type="range" min="0" max="100" value="0" />
                <output name="result" class=result>0</output>
            </label>
            <label> Saturate:
                <input name="saturate" data-sizing="%" type="range" min="0" max="200" value="100" />
                <output name="result" class=result>100</output>
            </label>
            <label> Hue rotate:
                <input name="hue" data-sizing="deg" type="range" min="0" max="360" value="0" />
                <output name="result" class=result>0</output>
            </label>
        </div>
        <div class="editor">
            <div class="btn-container">
                <button class="btn btn-reset" onclick="window.location.reload();">Reset</button>
                <button class="btn btn-next btn-active">Next picture</button>
                <label class="btn btn-load" for="btnInput"> Load picture
                    <input class="btn-load--input" id="btnInput" name="upload" type="file" placeholder="Load picture" /> </label>
                <button class="btn btn-save">Save picture</button>
            </div>
            <img src="assets/img/1.jpg" alt="image" class="img-load"/>
            <canvas></canvas>
        </div>
    </main>
    <footer class="footer">
        <div class="footer-container"> <a class="github" href="#" target="_blank" rel="noopener noreferrer">github</a>
            <a class="rss" href="https://rs.school/js/" target="_blank" rel="noopener"> <span class="rss-year">'21</span> </a>
        </div>
    </footer>
    <button class="fullscreen openfullscreen"></button>
    <script>
        const inputs = document.querySelectorAll(".filters input");
        const result = document.querySelectorAll("output");

        function handleUpdate() {
            const suffix = this.dataset.sizing || '';
            document.documentElement.style.setProperty(`--${this.name}`, this.value + suffix);
        }
        inputs.forEach(input => input.addEventListener('change', handleUpdate));
        inputs.forEach(input => input.addEventListener('mousemove', handleUpdate));
        let img_load = document.querySelector(".img-load");
        let next_btn = document.querySelector(".btn-next");
        let imgs = new Array("assets/img/1.jpg", "assets/img/2.jpg", "assets/img/3.jpg", "assets/img/4.jpg");
        let i = 0;
        console.log(imgs.length);
        next_btn.onclick = function () {
            if (i < imgs.length) {
                i++;
                if (i == imgs.length) {
                    i = 0;
                    img_load.src = imgs[i];
                }
                else {
                    img_load.src = imgs[i];
                }
            }
        }
        const fileInput = document.querySelector('input[type="file"]');
        const imageContainer = document.querySelector('.img-load');
        fileInput.addEventListener('change', function (e) {
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                imageContainer.src = reader.result;
            }
            reader.readAsDataURL(file);
        });
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        const download = document.querySelector('.btn-save');
        const image = document.querySelector(".img-load");

        function drawImage(){
            const img = new Image();
            img.setAttribute('crossOrigin', 'anonymous');
            img.src = image.src;
            img.onload = function(){
              canvas.width = img.width;
              canvas.height = img.height;
              ctx.drawImage(img, 0, 0);
            };
        }


        download.addEventListener('click', function(e){
            drawImage();
            let link = document.createElement("a");
            link.download = 'download.png';
            link.href = canvas.toDataURL();
            link.click();
            link.delete;

        });

        const fullscreen_btn = document.querySelector('.fullscreen');
        fullscreen_btn.onclick = function(){
            if(window.innerHeight == screen.height)
                    document.webkitCancelFullScreen();
            else
                    document.documentElement.requestFullscreen();
      }
    </script>
</body>

</html>
